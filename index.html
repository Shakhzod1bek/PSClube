<!DOCTYPE html>
<html lang="uz">

<head>
  <meta charset="UTF-8">
  <title>PS3 Timer</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0 auto;
      padding-top: 15px;
      width: 750px;
      max-width: 100%;
      display: flex;
      text-align: center;
      background: linear-gradient(150deg,
          #000000 0%,
          #ff0000 23%,
          #f07070 10%);

    }

    #pasdagi {
      position: fixed;
      background: orange;
      top: 20px;
      left: 20px;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 50px;
      z-index: 10000;
    }

    p {
      font-size: 45px;
      margin: 45px 0;
      font-weight: 700;
      transform: scaleY(1.7);
    }

    h3 {
      font-weight: 800;
      font-size: 45px;
      margin: 10px 0 0 0;
      transform: scaleY(1.6);
      display: inline-block;
    }

    /* === HISOBOT TAB === */
    #logTab {
      display: none;
      /* Bosilganda ko‚Äòrsatiladi */
      position: fixed;
      width: 350px;
      inset: 0;
      background: #f5f7fb;
      padding: 16px;
      overflow-y: auto;
      z-index: 9999;
      font-family: Arial, sans-serif;
    }

    #logTab h2 {
      margin-top: 0;
      color: #0d47a1;
      text-align: center;
    }

    #logTab button {
      padding: 10px 14px;
      border: none;
      border-radius: 8px;
      margin: 5px 4px;
      font-size: 16px;
      cursor: pointer;
    }

    #logTab button:first-of-type {
      background: #607d8b;
      color: #fff;
    }

    #logTab button:last-of-type {
      background: #d32f2f;
      color: #fff;
    }

    #logList {
      list-style: none;
      padding: 0;
      margin-top: 15px;
    }

    #logList li {
      background: #fff;
      margin-bottom: 10px;
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
      font-size: 24px;
      line-height: 1.4;
    }

    @media (max-width: 600px) {
      #logTab {
        padding: 10px;
      }

      #logList li {
        font-size: 13px;
      }
    }

    .ps {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .timer {
      background: #bdbdbd8c;
      padding: 15px;
      width: 550px;
      height: 1040px;
      border-radius: 16px;
      margin: 2rem 0;
      box-shadow: 0 8px 20px rgba(13, 71, 161, 0.15);
      border-top: 6px solid #1976d2;
    }

    .timer h3 {
      color: #1565c0;
      margin-bottom: 10px;
    }

    .time {
      font-weight: bold;
      font-size: 28px;
      font-weight: 700;
      color: #0d47a1;
      transform: scaleY(2);
      font-weight: 900;
      display: inline-block;
    }

    .cost {
      font-weight: bold;
      color: #1a237e;
    }

    button {
      width: 100%;
      height: 6rem;
      margin-top: 6px;
      border-radius: 8px;
      font-size: 36px;
      font-weight: 800;
      border: none;
      cursor: pointer;
    }

    .tarif-btn {
      background: #e3f2fd;
      color: #0d47a1;
    }

    .tarif-btn.active {
      background: #1976d2;
      color: #fff;
    }

    .start-btn {
      background: #19d238;
      color: #fff;
    }

    .stop-btn {
      background: #eb2121;
      color: #fff;
    }

    .reset-btn {
      background: rgb(239, 8, 162);
      color: #fff;
    }
  </style>
</head>

<body>


  <!-- HISOBOTLAR TAB -->
  <div id="logTab">
    <h2>üìë Hisobotlar</h2>
    <button onclick="closeLogTab()">‚ùå Yopish</button>
    <button onclick="clearLogs()" style="background:red;color:white;">üóë Tozalash</button>
    <ul id="logList"></ul>
  </div>

  <!-- PS TIMERLAR -->
  <div class="ps">
    <!-- 1-Stol -->
    <div class="timer" data-stol="1-Stol">
      <h3>1-Stol</h3>
      <p>Vaqt: <span class="time">00:00:00:000</span></p>
      <p>Tarif: <span class="current-tarif">Tanlanmagan</span></p>
      <p>Summa: <span class="cost">0</span> so'm</p>

      <button class="tarif-btn" onclick="setTarif(this,20000)">2 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,24000)">3 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,25000)">4 ta pult</button>

      <button class="start-btn" onclick="startTimer(this)">Start</button>
      <button class="stop-btn" onclick="stopTimer(this)">Stop</button>
      <button class="reset-btn" onclick="resetTimer(this)">Reset</button>
    </div>

    <!-- 2-Stol -->
    <div class="timer" data-stol="2-Stol">
      <h3>2-Stol</h3>
      <p>Vaqt: <span class="time">00:00:00:000</span></p>
      <p>Tarif: <span class="current-tarif">Tanlanmagan</span></p>
      <p>Summa: <span class="cost">0</span> so'm</p>

      <button class="tarif-btn" onclick="setTarif(this,20000)">2 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,24000)">3 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,25000)">4 ta pult</button>

      <button class="start-btn" onclick="startTimer(this)">Start</button>
      <button class="stop-btn" onclick="stopTimer(this)">Stop</button>
      <button class="reset-btn" onclick="resetTimer(this)">Reset</button>
    </div>

    <!-- 3-Stol -->
    <div class="timer" data-stol="3-Stol">
      <h3>3-Stol</h3>
      <p>Vaqt: <span class="time">00:00:00:000</span></p>
      <p>Tarif: <span class="current-tarif">Tanlanmagan</span></p>
      <p>Summa: <span class="cost">0</span> so'm</p>

      <button class="tarif-btn" onclick="setTarif(this,1411114000)">2 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,18000)">3 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,20000)">4 ta pult</button>

      <button class="start-btn" onclick="startTimer(this)">Start</button>
      <button class="stop-btn" onclick="stopTimer(this)">Stop</button>
      <button class="reset-btn" onclick="resetTimer(this)">Reset</button>
    </div>

    <div class="timer" data-stol="4-Stol">
      <h3>3-Stol</h3>
      <p>Vaqt: <span class="time">00:00:00:000</span></p>
      <p>Tarif: <span class="current-tarif">Tanlanmagan</span></p>
      <p>Summa: <span class="cost">0</span> so'm</p>

      <button class="tarif-btn" onclick="setTarif(this,20000)">2 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,24000)">3 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,25000)">4 ta pult</button>

      <button class="start-btn" onclick="startTimer(this)">Start</button>
      <button class="stop-btn" onclick="stopTimer(this)">Stop</button>
      <button class="reset-btn" onclick="resetTimer(this)">Reset</button>
    </div>


    <div class="timer" data-stol="5-Stol">
      <h3>3-Stol</h3>
      <p>Vaqt: <span class="time">00:00:00:000</span></p>
      <p>Tarif: <span class="current-tarif">Tanlanmagan</span></p>
      <p>Summa: <span class="cost">0</span> so'm</p>

      <button class="tarif-btn" onclick="setTarif(this,20000)">2 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,24000)">3 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,25000)">4 ta pult</button>


      <button class="start-btn" onclick="startTimer(this)">Start</button>
      <button class="stop-btn" onclick="stopTimer(this)">Stop</button>
      <button class="reset-btn" onclick="resetTimer(this)">Reset</button>
    </div>

    <div class="timer" data-stol="6-Stol">
      <h3>3-Stol</h3>
      <p>Vaqt: <span class="time">00:00:00:000</span></p>
      <p>Tarif: <span class="current-tarif">Tanlanmagan</span></p>
      <p>Summa: <span class="cost">0</span> so'm</p>

      <button class="tarif-btn" onclick="setTarif(this,20000)">2 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,24000)">3 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,25000)">4 ta pult</button>


      <button class="start-btn" onclick="startTimer(this)">Start</button>
      <button class="stop-btn" onclick="stopTimer(this)">Stop</button>
      <button class="reset-btn" onclick="resetTimer(this)">Reset</button>
    </div>


    <div class="timer" data-stol="7-Stol">
      <h3>3-Stol</h3>
      <p>Vaqt: <span class="time">00:00:00:000</span></p>
      <p>Tarif: <span class="current-tarif">Tanlanmagan</span></p>
      <p>Summa: <span class="cost">0</span> so'm</p>

      <button class="tarif-btn" onclick="setTarif(this,20000)">2 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,24000)">3 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,25000)">4 ta pult</button>


      <button class="start-btn" onclick="startTimer(this)">Start</button>
      <button class="stop-btn" onclick="stopTimer(this)">Stop</button>
      <button class="reset-btn" onclick="resetTimer(this)">Reset</button>
    </div>


    <div class="timer" data-stol="8-Stol">
      <h3>3-Stol</h3>
      <p>Vaqt: <span class="time">00:00:00:000</span></p>
      <p>Tarif: <span class="current-tarif">Tanlanmagan</span></p>
      <p>Summa: <span class="cost">0</span> so'm</p>

      <button class="tarif-btn" onclick="setTarif(this,20000)">2 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,24000)">3 ta pult</button>
      <button class="tarif-btn" onclick="setTarif(this,25000)">4 ta pult</button>


      <button class="start-btn" onclick="startTimer(this)">Start</button>
      <button class="stop-btn" onclick="stopTimer(this)">Stop</button>
      <button class="reset-btn" onclick="resetTimer(this)">Reset</button>
    </div>

  </div>

  <!-- OPEN LOG BUTTON -->
  <div id="pasdagi" onclick="openLogTab()">üìë</div>

  <script>
    /*********************************
     * GLOBAL
     *********************************/
    const timers = new Map();
    const STORAGE_KEY = "ps3_real_timers";
    const LOG_KEY = "ps3_logs";

    /*********************************
     * STORAGE
     *********************************/
    function loadData() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; }
      catch { return {}; }
    }
    function saveData(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    /*********************************
     * LOG STORAGE
     *********************************/
    function loadLogs() {
      try { return JSON.parse(localStorage.getItem(LOG_KEY)) || []; }
      catch { return []; }
    }
    function saveLogs(logs) {
      localStorage.setItem(LOG_KEY, JSON.stringify(logs));
    }

    /*********************************
     * TARIF (NARX BILAN)
     *********************************/
    function setTarif(btn, rate) {
      const box = btn.closest(".timer");

      box.rate = rate;
      box.tarifName = btn.innerText;

      // üî• NARX FORMATLAB CHIQARISH
      const priceText = rate.toLocaleString() + " so'm";

      box.querySelector(".current-tarif").innerText =
        `${btn.innerText} ‚Äì ${priceText}`;

      box.querySelectorAll(".tarif-btn")
        .forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    }

    /*********************************
     * START
     *********************************/
    function startTimer(btn) {
      const box = btn.closest(".timer");
      if (!box.rate) {
        alert("Avval tarif tanlang!");
        return;
      }
      if (timers.has(box)) return;

      const stol = box.dataset.stol;
      const data = loadData();

      const startTime = data[stol]?.startTime ?? Date.now();

      data[stol] = {
        startTime,
        rate: box.rate,
        tarif: box.tarifName
      };
      saveData(data);

      box.startTime = startTime;
      showStartedAt(box, startTime);

      const interval = setInterval(() => drawUI(box), 50);
      timers.set(box, interval);
    }

    /*********************************
     * STOP
     *********************************/
    function stopTimer(btn) {
      const box = btn.closest(".timer");
      if (!timers.has(box)) return;

      clearInterval(timers.get(box));
      timers.delete(box);

      const elapsed = Date.now() - box.startTime;
      const cost = Math.round(elapsed / 3600000 * box.rate);

      addLog({
        stol: box.dataset.stol,
        tarif: `${box.tarifName} ‚Äì ${box.rate.toLocaleString()} so'm`,
        rate: box.rate,
        timeMs: elapsed,
        cost
      });
    }

    /*********************************
     * RESET
     *********************************/
    function resetTimer(btn) {
      const box = btn.closest(".timer");

      if (timers.has(box)) {
        clearInterval(timers.get(box));
        timers.delete(box);
      }

      const data = loadData();
      delete data[box.dataset.stol];
      saveData(data);

      box.querySelector(".time").innerText = "00:00:00:000";
      box.querySelector(".cost").innerText = "0";
      box.querySelector(".current-tarif").innerText = "Tanlanmagan";
      box.querySelectorAll(".tarif-btn").forEach(b => b.classList.remove("active"));

      const p = box.querySelector(".started-at");
      if (p) { p.style.display = "none"; p.innerText = ""; }
    }

    /*********************************
     * UI DRAW
     *********************************/
    function drawUI(box) {
      const elapsed = Date.now() - box.startTime;

      const h = Math.floor(elapsed / 3600000);
      const m = Math.floor((elapsed % 3600000) / 60000);
      const s = Math.floor((elapsed % 60000) / 1000);
      const ms = elapsed % 1000;

      box.querySelector(".time").innerText =
        `${String(h).padStart(2, "0")}:` +
        `${String(m).padStart(2, "0")}:` +
        `${String(s).padStart(2, "0")}:` +
        `${String(ms).padStart(3, "0")}`;

      const cost = Math.round(elapsed / 3600000 * box.rate);
      box.querySelector(".cost").innerText = cost.toLocaleString();
    }

    /*********************************
     * STARTED AT
     *********************************/
    function showStartedAt(box, time) {
      let p = box.querySelector(".started-at");
      if (!p) {
        p = document.createElement("p");
        p.className = "started-at";
        p.style.color = "green";
        box.insertBefore(p, box.children[1]);
      }

      const d = new Date(time);
      p.style.display = "block";
      p.innerText =
        `Boshlangan: ${String(d.getHours()).padStart(2, "0")}:` +
        `${String(d.getMinutes()).padStart(2, "0")}:` +
        `${String(d.getSeconds()).padStart(2, "0")}`;
    }

    /*********************************
     * LOG FUNCTIONS
     *********************************/
    function addLog({ stol, tarif, rate, timeMs, cost }) {
      const logs = loadLogs();
      logs.unshift({
        stol,
        tarif,
        rate,
        timeMs,
        cost,
        date: new Date().toLocaleString()
      });
      saveLogs(logs);
      renderLogs();
    }

    function msToTime(ms) {
      const h = Math.floor(ms / 3600000);
      const m = Math.floor((ms % 3600000) / 60000);
      const s = Math.floor((ms % 60000) / 1000);
      return `${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
    }

    function renderLogs() {
      const list = document.getElementById("logList");
      list.innerHTML = "";

      const logs = loadLogs();
      if (logs.length === 0) {
        list.innerHTML = "<li>Hozircha hisobot yo‚Äòq</li>";
        return;
      }

      logs.forEach(l => {
        const li = document.createElement("li");
        li.innerHTML = `
      <b>${l.stol}</b><br>
      Tarif: ${l.tarif}<br>
      Vaqt: ${msToTime(l.timeMs)}<br>
      Summa: <b>${l.cost.toLocaleString()} so‚Äòm</b><br>
      <small>${l.date}</small>
    `;
        list.appendChild(li);
      });
    }

    /*********************************
     * LOG TAB
     *********************************/
    function openLogTab() {
      document.getElementById("logTab").style.display = "block";
      renderLogs();
    }
    function closeLogTab() {
      document.getElementById("logTab").style.display = "none";
    }
    function clearLogs() {
      if (!confirm("Barcha hisobotlar o‚Äòchirilsinmi?")) return;
      localStorage.removeItem(LOG_KEY);
      renderLogs();
    }

    /*********************************
     * AUTO RESTORE
     *********************************/
    window.addEventListener("load", () => {
      const data = loadData();

      document.querySelectorAll(".timer").forEach(box => {
        const saved = data[box.dataset.stol];
        if (!saved) return;

        box.rate = saved.rate;
        box.tarifName = saved.tarif;
        box.startTime = saved.startTime;

        box.querySelector(".current-tarif").innerText =
          `${saved.tarif} ‚Äì ${saved.rate.toLocaleString()} so'm`;

        showStartedAt(box, box.startTime);

        const interval = setInterval(() => drawUI(box), 50);
        timers.set(box, interval);
      });
    });
  </script>

</body>

</html>
